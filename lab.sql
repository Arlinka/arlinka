CREATE TABLE POSITIONS (
    ID_POSITIONS INTEGER GENERATED BY DEFAULT AS IDENTITY,
    NAME_POSITIONS VARCHAR2(20) NOT NULL,
    PRIMARY KEY(ID_POSITIONS)
);

CREATE TABLE UNITS (
    ID_UNITS INTEGER GENERATED BY DEFAULT AS IDENTITY,
    NAME_UNITS VARCHAR2(20) NOT NULL,
    FULLNAME_UNITS VARCHAR2(40) NOT NULL,
    PRIMARY KEY(ID_UNITS)
);

CREATE TABLE ETKS (
    TARIFF_DISCHARGE INTEGER GENERATED BY DEFAULT AS IDENTITY,
    TARIFF_RATIO NUMBER(3,2) NOT NULL,
    PRIMARY KEY(ID_ETKS)
);

CREATE TABLE CATEGORIES (
    ID_CATEGORIES INTEGER GENERATED BY DEFAULT AS IDENTITY,
    NAME_CATEGORIES VARCHAR2(20) NOT NULL,
    PRIMARY KEY(ID_CATEGORIES)
);

CREATE TABLE STAFF (
    ID_STAFF INTEGER GENERATED BY DEFAULT AS IDENTITY,
    ID_UNITS INTEGER,
    ID_POSITIONS INTEGER,
    ID_CATEGORIES INTEGER,
    NAME_STAFF VARCHAR2(20) NOT NULL,
    DATE_BIRTH DATE NOT NULL,
    SEX VARCHAR2(3) NOT NULL,
    ADDRES VARCHAR2(100) NOT NULL,
    PHONE_NUMBER VARCHAR2(17) NOT NULL,
    PRIMARY KEY(ID_STAFF),
    CONSTRAINT ID_STAFF_UNITS
        FOREIGN KEY(ID_UNITS)
        REFERENCES UNITS ON DELETE SET NULL,
    CONSTRAINT ID_STAFF_POSITIONS
        FOREIGN KEY(ID_POSITIONS)
        REFERENCES POSITIONS ON DELETE SET NULL,
    CONSTRAINT ID_STAFF_CATEGORIES
        FOREIGN KEY(ID_CATEGORIES)
        REFERENCES CATEGORIES ON DELETE SET NULL,
    CONSTRAINT CHECK_SEX 
        CHECK(SEX IN('муж','жен')),
    CONSTRAINT PHONE_NUMBER_STAFF
        CHECK(REGEXP_LIKE(PHONE_NUMBER, '^\+375\(\d{2}\)\d{3}-\d{2}-\d{2}$')),
    CONSTRAINT UNIQUE_PHONE_NUMBER UNIQUE(PHONE_NUMBER)
);

CREATE TABLE SCHEDULE(
    ID_SCHEDULE INTEGER GENERATED ALWAYS AS IDENTITY,
    DATE_CHANGE DATE,
    ID_STAFF INTEGER,
    TARIFF_DISCHARGE INTEGER,
    TARIFF_RATIO NUMBER(3,2),
    TARIFF_RATE_ETC NUMBER(5,2) NOT NULL,
    INCREASE_BY_CONTRACT INTEGER NOT NULL,
    SALARY NUMBER(6,2) NOT NULL,
    PRIMARY KEY(ID_SCHEDULE),
    CONSTRAINT ID_SCHEDULE_STAFF
        FOREIGN KEY(ID_STAFF)
        REFERENCES STAFF ON DELETE SET NULL,
    CONSTRAINT ID_SCHEDULE_TARIFF_DISCHARGE
        FOREIGN KEY(TARIFF_DISCHARGE)
        REFERENCES ETKS ON DELETE SET NULL,
);

set linesize 900;

--CREATE SYNONYM basket FOR service_basket;
--CREATE INDEX idx_date_of_s ON settlement(date_of_s);

INSERT ALL
    INTO POSITIONS(NAME_POSITIONS) VALUES('Директор')
    INTO POSITIONS(NAME_POSITIONS) VALUES('Главный инженер')
    INTO POSITIONS(NAME_POSITIONS) VALUES('Заместитель директора по идеологической работе и общим вопросам')
    INTO POSITIONS(NAME_POSITIONS) VALUES('Заместитель главного инженера')
SELECT * FROM DUAL;

INSERT ALL
    INTO UNITS(NAME_UNITS, FULLNAME_UNITS) VALUES('УП', 'Управление')
    INTO UNITS(NAME_UNITS, FULLNAME_UNITS) VALUES('НСС', 'Начальники смен электростанции')
    INTO UNITS(NAME_UNITS, FULLNAME_UNITS) VALUES('ОНиОТ', 'Отдел  надежности и охраны труда')
SELECT * FROM DUAL;

INSERT ALL
    INTO ETKS(TARIFF_DISCHARGE, TARIFF_RATIO) VALUES(1, 1.00)
    INTO ETKS(TARIFF_DISCHARGE, TARIFF_RATIO) VALUES(2, 1.16)
    INTO ETKS(TARIFF_DISCHARGE, TARIFF_RATIO) VALUES(3, 1.35)
SELECT * FROM DUAL;

INSERT ALL
    INTO CATEGORIES(NAME_CATEGORIES) VALUES('Pуководитель')
    INTO CATEGORIES(NAME_CATEGORIES) VALUES('Cпециалист 1 категории')
    INTO CATEGORIES(NAME_CATEGORIES) VALUES('Cпециалист 2 категории')
    INTO CATEGORIES(NAME_CATEGORIES) VALUES('Cпециалист')
    INTO CATEGORIES(NAME_CATEGORIES) VALUES('Cлужащий')
SELECT * FROM DUAL;

INSERT ALL
    INTO STAFF(ID_UNITS, ID_POSITIONS, ID_CATEGORIES, NAME_STAFF, DATE_BIRTH, SEX, ADDRES, PHONE_NUMBER) VALUES(1, 1, 1, 'Лепель П.В.', TO_DATE('01.09.1976','DD.MM.YYYY'), 'муж', 'ул. Московская, 17‑19', '+375(29)564-88-55')
    INTO STAFF(ID_UNITS, ID_POSITIONS, ID_CATEGORIES, NAME_STAFF, DATE_BIRTH, SEX, ADDRES, PHONE_NUMBER) VALUES(1, 2, 1, 'Судаков Н.И.', TO_DATE('01.03.1967','DD.MM.YYYY'), 'муж', 'ул. Козлова, 7‑38', '+375(25)666-45-85')
    INTO STAFF(ID_UNITS, ID_POSITIONS, ID_CATEGORIES, NAME_STAFF, DATE_BIRTH, SEX, ADDRES, PHONE_NUMBER) VALUES(1, 3, 1, 'Савостенко А.Н.', TO_DATE('20.04.1967','DD.MM.YYYY'), 'муж', 'ул. Богдановича, 102‑34', '+375(44)123-45-67')
SELECT * FROM DUAL;

INSERT ALL
    INTO SCHEDULE(DATE_CHANGE, ID_STAFF, TARIFF_DISCHARGE, TARIFF_RATIO, TARIFF_RATE_ETC, INCREASE_BY_CONTRACT, SALARY) VALUES(TO_DATE('15.05.2020','DD.MM.YYYY'), 1, 22, 5.59, 672.00, 50, 1140.00)
    INTO SCHEDULE(DATE_CHANGE, ID_STAFF, TARIFF_DISCHARGE, TARIFF_RATIO, TARIFF_RATE_ETC, INCREASE_BY_CONTRACT, SALARY) VALUES(TO_DATE('15.05.2020','DD.MM.YYYY'), 2, 21, 5.22, 672.00, 50, 1126.00)
    INTO SCHEDULE(DATE_CHANGE, ID_STAFF, TARIFF_DISCHARGE, TARIFF_RATIO, TARIFF_RATE_ETC, INCREASE_BY_CONTRACT, SALARY) VALUES(TO_DATE('15.05.2020','DD.MM.YYYY'), 3, 20, 4.88, 587.00, 50, 1054.00)
    INTO SCHEDULE(DATE_CHANGE, ID_STAFF, TARIFF_DISCHARGE, TARIFF_RATIO, TARIFF_RATE_ETC, INCREASE_BY_CONTRACT, SALARY) VALUES(TO_DATE('15.05.2020','DD.MM.YYYY'), 4, 20, 4.88, 587.00, 50, 1054.00)
SELECT * FROM DUAL;

SELECT * FROM POSITIONS;
SELECT * FROM UNITS;
SELECT * FROM ETKS;
SELECT * FROM CATEGORIES;
SELECT * FROM STAFF;
SELECT * FROM SCHEDULE;
